<!DOCTYPE html>
<html>
<head>
    <title>Think of a Title</title>
    <style>
            /* Styling for the table and buttons */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
            background-color: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        table, th, td {
            border: 1px solid #ccc;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        .button {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            padding: 8px 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.2s;
        }

        .button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        .button-primary {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            padding: 8px 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.2s;
        }

        .button-primary:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        /* Styling for the popup container (initially hidden) */
        .popup-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        /* CSS for the smaller popup */
        .popup-box-small {
            background-color: #fff;
            padding: 10px; /* Smaller padding */
            border-radius: 5px;
            text-align: left; /* Align options vertically */
            max-height: 300px; /* Maximum height to enable scrolling if many options */
            overflow-y: auto; /* Enable vertical scrolling if needed */
        }

        /* Display radio buttons and labels vertically */
        .popup-box-small {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }

        .popup-box-small label {
            display: block;
        }

        .popup-box-small input[type="radio"] {
            margin-right: 5px;
        }

        p {
            text-align: center;
        }

        .hide-row {
            display: none;
        }

        .form-container {
            display: none;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            margin: 20px auto;
            max-width: 600px;
        }

        /* Additional styling for the form elements */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-section h3 {
            color: #007bff;
            font-size: 20px;
            margin: 20px 0;
        }

        /* Styling for the statistics container */
        .statistics-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .statistics-item {
            flex: 0 1 calc(50% - 20px); /* Two items per row with some spacing */
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Additional styling for the statistics */
        .statistics-item p {
            margin: 5px 0;
            text-align: center;
            font-size: 18px;
        }

        .statistics-item span {
            font-size: 24px;
            font-weight: bold;
            color: #007bff; /* Blue color for the numbers */
        }

    </style>
</head>
<body>
  <h1>Statistics</h1>
  <div class="statistics-container">
    <div class="statistics-item">
      <p>Untreated Cavities: <span contenteditable="false" id="untreatedCavities">0</span></p>
    </div>
    <div class="statistics-item">
      <p>Caries Experience: <span contenteditable="false" id="cariesExperience">0</span></p>
    </div>
    <div class="statistics-item">
      <p>Sealants Present:  <span contenteditable="false" id="sealantPresent">0</span></p>
    </div>
    <div class="statistics-item">
      <p>Referred for treatment: <span contenteditable="false" id="referredTreatment">0</span></p>
    </div>
  </div>
  <br/>

  <button class="button" id="screeningButton">
    Screening
  </button>

  <button class="button" id="preventativeButton">
    Preventative
  </button>

  <button class="button" id="followupButton">
    Follow Up
  </button>

<!--    Screening code starts here-->
    <table id="table1">
      <tr class="hide-row">
        <!-- Create buttons for each tooth -->
        <% (1..3).each do |tooth_number| %>
          <td><button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')"><%= tooth_number %></button></td>
        <% end %>
        <% (4..13).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= tooth_number %><br><%= ('A'..'J').to_a[tooth_number - 4] %>
            </button>
          </td>
        <% end %>
        <% (14..16).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= tooth_number %>
            </button>
          </td>
        <% end %>
      </tr>
      <tr class="hide-row">
        <% (1..16).each do |tooth_number|%>
            <td data-cell="popup<%= tooth_number %>">Make a selection</td>
        <% end %>
      </tr>
<!--      Preventative code starts here-->
      <tr class="hide-row">
        <% (1..16).each do |tooth_number| %>
          <td>
            <% if tooth_number == 3 || tooth_number == 14 %>
              <p>Make a Selection for Preventative</p>
            <% end %>
          </td>
        <% end %>
      </tr>
<!--      Follow Up code starts here-->
      <tr class="hide-row">
        <% (1..16).each do |tooth_number| %>
          <td>
            <% if tooth_number == 3 || tooth_number == 14 %>
              <p>Make a Selection for Follow Up</p>
            <% end %>
          </td>
        <% end %>
      </tr>
      </table>
<!--      second screening table starts here-->
      <table id="table2">
      <tr class="hide-row">
        <% (32).downto(30).each do |tooth_number| %>
          <td><button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')"><%= tooth_number %></button></td>
        <% end %>
        <% (29).downto(20).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= ('T'.ord).downto('K'.ord).map(&:chr)[29 - tooth_number] %> <br> <%= tooth_number %>
            </button>
          </td>
        <% end %>
        <% (19).downto(17).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= tooth_number %>
            </button>
          </td>
        <% end %>
      </tr>
<!--        second preventative table starts here-->
      <tr class="hide-row">
        <% (32).downto(17).each do |tooth_number|%>
          <td data-cell="popup<%= tooth_number %>">Make a Selection</td>
        <% end %>
      </tr>
      <tr class="hide-row">
        <% (32).downto(17).each do |tooth_number| %>
          <td>
            <% if tooth_number == 30 || tooth_number == 19 %>
              <p>Make a Selection for Preventative</p>
            <% end %>
          </td>
        <% end %>
      </tr>
<!--        second follow up table starts here-->
      <tr class="hide-row">
        <% (32).downto(17).each do |tooth_number| %>
          <td>
            <% if tooth_number == 30 || tooth_number == 19 %>
              <p>Make a Selection for Follow Up</p>
            <% end %>
          </td>
        <% end %>
      </tr>
    </table>
    <br>
    <% (1..32).each do |tooth_number| %>
      <div class="popup-container" id="popup<%= tooth_number %>">
        <div class="popup-box-small">
          <p><%= tooth_number %></p>
          <% radio_options = [
            { value: "D", label: "D - Decay" },
            { value: "F", label: "F - Filled" },
            { value: "M", label: "M - Missing" },
            { value: "S", label: "S - Sealant Present" },
            # { value: "PS", label: "PS - Prescribe Present" },
            { value: "RS", label: "RS - Recommended Reseal" },
            { value: "no mark", label: "No Treatment (No Mark)" }
          ] %>
          <% radio_options.each do |option| %>
            <label>
              <input type="radio" name="radio<%= tooth_number %>" value="<%= option[:value] %>">
              <%= option[:label] %>
            </label>
          <% end %>
          <button onclick="closePopup('<%= tooth_number %>','popup<%= tooth_number %>')">Close</button>
        </div>
      </div>
    <% end %>
<br/>
    <button class="button-primary" id="showPreventativeFormButton">
      Preventative Form
    </button>
    <button class="button-primary" id="showFollowUpFormButton">
      FollowUp Form
    </button>
<br/>
<%= form_with model: @child_level_detail, url: child_level_details_path, local: true, id: 'unique-form-id' do |form| %>
   
    <div class="form-container" id="preventativeFormContainer" style="display: none;">
      <form>
        <div class="form-group">
          <label for="prescriberName">Sealant Prescriberâ€™s Signature</label>
          <input type="text" id="prescriberName" name="child_level_detail[PrescriberName]">
        </div>
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" id="date" name="child_level_detail[ScreenDate]">
        </div>
        <div class="form-group">
          <label for="comment">Comment</label>
          <textarea id="comment" name="child_level_detail[ScreenComment]" rows="2" cols="20"></textarea>
        </div>
        <div class="form-group">
          <label for="providerName">Provider's Name</label>
          <input type="text" id="providerName" name="child_level_detail[ProviderName]">
        </div>
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" id="date" name="child_level_detail[ProviderDate]">
        </div>
        <div class="form-group">
          <label for="comment">Comment</label>
          <textarea id="comment"  rows="2" cols="20" name="child_level_detail[PreventComment]"></textarea>
        </div>
        <div class="form-section">
          <h3>Data for SEALS</h3>
        </div>
        <div class="form-group">
          <label for="num1stMolarsSealed">Number of 1st molars sealed</label>
          <input type="text" id="num1stMolarsSealed" name="child_level_detail[FirstSealedNum]">
        </div>
        <div class="form-group">
          <label for="num2ndMolarsSealed">Number of 2nd molars sealed</label>
          <input type="text" id="num2ndMolarsSealed" name="child_level_detail[SecondSealedNum]">
        </div>
        <div class="form-group">
          <label for="numOtherSealed">Number of other permanent sealed</label>
          <input type="text" id="numOtherSealed"name="child_level_detail[OtherPermNum]" >
        </div>
        <div class="form-group">
          <label for="numPrimaryTeethSealed">Number of primary teeth sealed</label>
          <input type="text" id="numPrimaryTeethSealed" name="child_level_detail[PrimarySealed]">
        </div>
        <div class="form-group">
          <label for="fluorideVarnish">Fluoride varnish provided</label>
          <select name="child_level_detail[FluorideVarnish]" id="fluorideVarnish">
            <option value="">--Please select an option--</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>
      </form>
    </div>

    <br/>
  
    <div class="form-container" id="followUpFormContainer" style="display: none;">
      <form>
        <div class="form-group">
          <label for="Evaluator's Name">Evaluator's Name</label>
          <input type="text" id="evaName" name="child_level_detail[EvaluatorsName]">
        </div>
        <br/>
        <div class="form-group">
          <label for="date">Date</label>
          <label for="blank"></label>
          <input type="date" id="date" name="date" name="child_level_detail[EvaluatorDate]"><br>
        </div>
        <br/>
        <div class="form-group">
          <label for="Comment">Comment</label>
          <textarea id="comment" rows="2" cols="20" name="child_level_detail[EvaluatorComment]"></textarea><br>
        </div>
        <br/>
        <br/>
        <div class="form-group">
          <H3>Data for SEALS</H3>
        </div>
        <div class="form-group">
          <label for="Number of teeth with retained sealant">Number of teeth with a retained sealant (0-8):</label>
          <input type="text" id="Number_of_teeth_with_a_retained_sealant" name="child_level_detail[RetainedSealant]">
        </div>
        <br/>

        <div class="form-group">
          <label for="Referred for Dental Treatment">Referred for Dental Treatment?</label>
          <label for="Yes">   </label>
          <label for="Yes">Yes</label>
          <input type="radio" name="child_level_detail[ReferredDT]" value="yes" id="Referred_for_Dental_Treatment_Yes">
          <label for="No">No</label>
          <input type="radio" name="child_level_detail[ReferredDT]" value="no" id="Referred_for_Dental_Treatment_No">
        </div>

        <br/>

        <div class="form-group">
          <label for="Referred for urgent Dental Treatment">Referred for urgent Dental Treatment?</label>
          <label for="blank">   </label>
          <label for="Yes">Yes</label>
          <input type="radio" name="child_level_detail[ReferredUDT]" value="yes" id="Referred_for_urgent_Dental_Treatment_Yes">
          <label for="No">No</label>
          <input type="radio" name="child_level_detail[ReferredUDT]" value="no" id="Referred_for_urgent_Dental_Treatment_No">
        </div>
        <br/>

        <div class="form-group">
          <label for="Total Number of Sealants received">Total Number of Sealants received:</label>
          <input type="text" id="Total_Sealants_received" name="child_level_detail[SealantsRecd]">
        </div>
        <br/>

        <div class="form-group">
          <label for="Total Number of Sealants needed">Total Number of Sealants needed:</label>
          <input type="text" id="Total_Sealants_needed" name="child_level_detail[SealnatsNeeded]">
        </div>
        <br/>

        <div class="form-group">
          <label for="Did the patients have caries experience">Did the patients have caries experience?</label>
          <label for="blank">   </label>
          <label for="Yes">Yes</label>
          <input type="radio" name="child_level_detail[Experienced]" value="yes" id="Did_the_patients_have_caries_experience_Yes">
          <label for="No">No</label>
          <input type="radio" name="child_level_detail[Experienced]" value="no" id="Did_the_patients_have_caries_experience_No">
          </div>
        <br/>

        <div class="form-group">
          <label for="Did the patient have untreated decay">Did the patient have untreated decay?</label>
          <label for="blank">   </label>
          <label for="Yes">Yes</label>
          <input type="radio" name="child_level_detail[UntreatedDecayFollow]" value="yes" id="Did_the_patient_have_untreated_decay_Yes">
          <label for="No">No</label>
          <input type="radio" name="child_level_detail[UntreatedDecayFollow]" value="no" id="Did_the_patient_have_untreated_decay_No">
        </div>
        <br/>

        <div class="form-group">
          <label for="Services the patient received">Services the patient received</label>
          <label for="blank">   </label>
          <select name="child_level_detail[Services]" >
            <option value="">--Please select an option--</option>
            <option value="Sealants">Sealants</option>
            <option value="Fluoride_Varnish">Fluoride Varnish</option>
            <option value="Oral_Assessment">Oral Assessment</option>
            <option value="Prophylaxes">Prophylaxes</option>
          </select>
        </div>
        <br/>
        <label for="Overall Oral Health Status">Overall Oral Health Status:</label><br>
        <textarea id="Overall_Oral_Health_Status" name="child_level_detail[ORHealthStatus]" rows="4" cols="50"></textarea><br>
        <br/>
        <input type="submit" value="Submit">
      </form>
    </div>
    <br/>


  <input type="submit" value="Submit" id="submitButton">
<% end %>
</body>

    <script>

        document.addEventListener("DOMContentLoaded", function() {
            ///Code for Screening

            const sections = {
                screening: 2,
                preventative: 3,
                followup: 4
            };

            // Track whether each section is currently visible
            const sectionVisibility = {
                screening: false,
                preventative: false,
                followup: false
            };

            // Add an event listener to the "Screening" button
            document.getElementById("screeningButton").addEventListener("click", function() {
                toggleSectionVisibility("screening");
            });

            // Add an event listener to the "Preventative" button
            document.getElementById("preventativeButton").addEventListener("click", function() {
                toggleSectionVisibility("preventative");
            });

            // Add an event listener to the "Follow Up" button
            document.getElementById("followupButton").addEventListener("click", function() {
                toggleSectionVisibility("followup");
            });

            function toggleSectionVisibility(section) {
                const table1Rows = document.querySelectorAll("#table1 tr");
                const table2Rows = document.querySelectorAll("#table2 tr");

                // Toggle visibility of the section
                sectionVisibility[section] = !sectionVisibility[section];

                // Determine the new display style for the section rows
                const displayStyle = sectionVisibility[section] ? "table-row" : "none";

                // Apply the display style to the section rows
                table1Rows.forEach((row, index) => {
                    if (index < sections[section]) {
                        row.style.display = displayStyle;
                    }
                });

                table2Rows.forEach((row, index) => {
                    if (index < sections[section]) {
                        row.style.display = displayStyle;
                    }
                });
            }

            const preventativeFormContainer = document.getElementById("preventativeFormContainer");
            const followUpFormContainer = document.getElementById("followUpFormContainer");
            const showPreventativeFormButton = document.getElementById("showPreventativeFormButton");
            const showFollowUpFormButton = document.getElementById("showFollowUpFormButton");

            let preventativeFormVisible = false;
            let followUpFormVisible = false;

            showPreventativeFormButton.addEventListener("click", function() {
                if (!preventativeFormVisible) {
                    preventativeFormContainer.style.display = "block";
                    followUpFormContainer.style.display = "none";
                    preventativeFormVisible = true;
                    followUpFormVisible = false;
                } else {
                    preventativeFormContainer.style.display = "none";
                    preventativeFormVisible = false;
                }
            });

            showFollowUpFormButton.addEventListener("click", function() {
                if (!followUpFormVisible) {
                    followUpFormContainer.style.display = "block";
                    preventativeFormContainer.style.display = "none";
                    followUpFormVisible = true;
                    preventativeFormVisible = false;
                } else {
                    followUpFormContainer.style.display = "none";
                    followUpFormVisible = false;
                }
            });

        });

        const selectedOptions = {}; // Object to hold selected options for each popup

            // Function to open the popup and set selected option
            function openPopup(popupId) {
                // console.log(selected)
                const popup = document.getElementById(popupId);

                // Show the popup
                if (popup) {
                    popup.style.display = 'block';
                }
            }

          // Function to save the selected option and close the popup
            function closePopup(Id, popupId) {
                const radioOptions = document.querySelectorAll(`input[name="radio${Id}"]`);
                const cell = document.querySelector(`td[data-cell="${popupId}"]`); // Add this line to select the corresponding cell

                console.log(cell);
                console.log(selectedOptions);

                // Find the selected option for the specific popup
                radioOptions.forEach(option => {
                    if (option.checked) {
                        selectedOptions[Id] = option.value; // Save the selected option to the object
                        cell.textContent = selectedOptions[popupId]; // Set the cell text to the selected option
                    }
                });

                // Close the popup
                closePopupActual(popupId);
                updateUntreatedCavities();
                updateReferredTreatment();
                updateCariesExperience();
                updateSealantPresent();
            }

            // Function to close the popup
            function closePopupActual(popupId) {
                const popup = document.getElementById(popupId);
                if (popup) {
                    popup.style.display = 'none';
                }
            }

            function updateUntreatedCavities() {
                let untreatedCavitiesCount = 0;

                for (const tooth in selectedOptions) {
                    if (selectedOptions[tooth] === 'D') {
                        untreatedCavitiesCount++;
                    }
                }

                const untreatedCavitiesElement = document.getElementById('untreatedCavities');

                // Update the "Untreated Cavities" field
                untreatedCavitiesElement.textContent = untreatedCavitiesCount;
            }

            function updateReferredTreatment() {
                let ReferredTreatmentCount = 0;

                for (const tooth in selectedOptions) {
                    if (selectedOptions[tooth] === 'RS') {
                        ReferredTreatmentCount++;
                    }
                }

                const referredTreatmentElement = document.getElementById('referredTreatment');

                // Update the "Untreated Cavities" field
                referredTreatmentElement.textContent = ReferredTreatmentCount;
            }

            function updateCariesExperience() {
                let CariesExperienceCount = 0;

                for (const tooth in selectedOptions) {
                    if (selectedOptions[tooth] === 'F') {
                        CariesExperienceCount++;
                    }
                }

                const cariesExperienceElement = document.getElementById('cariesExperience');

                // Update the "Untreated Cavities" field
                cariesExperienceElement.textContent = CariesExperienceCount;
            }

            function updateSealantPresent() {
                let SealantPresentCount = 0;

                for (const tooth in selectedOptions) {
                    if (selectedOptions[tooth] === 'S') {
                        SealantPresentCount++;
                    }
                }

                const sealantPresentElement = document.getElementById('sealantPresent');

                // Update the "Untreated Cavities" field
                sealantPresentElement.textContent = SealantPresentCount;
            }

      //to set hidden screening field      
          document.addEventListener("submit", function(event) {
            event.preventDefault();
            console.log("inside");

            // Check if the submit button with the specified ID was clicked
            if (event.submitter && event.submitter.id === "submitButton") {
              var form = event.target;

              // Your code to handle the specific form
              // For example, you can access form fields and submit the form

              var TeethScreeningStr = JSON.stringify(selectedOptions);
              var TeethScreeningInput = form.querySelector('[name="child_level_detail[TeethScreening]"]');
              TeethScreeningInput.value = TeethScreeningStr;

              form.submit();
            }
          });
    </script>

</html>